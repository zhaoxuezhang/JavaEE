<html>
<head>
  <title>SpringMVC源码</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="728"/>
<h1>SpringMVC源码</h1>

<div>
<span><div><ul><li><div><span style="font-size: 16pt;">1、前端控制器的架构？DispatcherServlet；</span></div></li><li><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image.png" type="image/png" data-filename="Image.png"/></span></div></li></ul><div><span style="font-size: 16pt;">doService是一个抽象方法。</span></div><hr/><div><span style="font-size: 16pt;">2、doDispatch具体细节</span></div><div><span style="font-size: 16pt;">核心方法有两个：</span></div><div><span style="font-size: 16pt;">（1）处理器的方法被调用，处理器也叫做控制器（controller）</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">（2）转发到目标页面</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [2].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">doDispatch</span><span style="font-size: 16pt;">具体的执行过程：</span></div><div><span style="font-size: 16pt;">    1.检查是否文件上传请求</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [3].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    2.根据当前请求找到具体哪个controller类能处理</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [4].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    3.如果没有找到哪个处理器能处理这个请求就404，抛异常</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [5].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    4.拿到能执行这个类的所有方法的适配器,名称叫做AnnotationMethodHandlerAdapter</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [6].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    5.适配器执行目标方法，返回值作为视图名，设置保存为ModelAndView中，controller中的目标方法无论怎么写，最终适配器执行完成</span><span style="font-size: 16pt;">后都会将执行后的信息封装成ModelAndView </span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [7].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">   6.根据方法最终执行完成后封装的ModelAndView，转发到对应的页面，而且</span><span style="font-size: 16pt;">ModelAndView中的数据可以从请求域中获取</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [8].png" type="image/png" data-filename="Image.png"/></span></div><hr/><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [9].png" type="image/png" data-filename="Image.png"/></span></div><hr/><div><span style="font-size: 16pt;">3、getHandler()细节：如何根据当前请求获取目标处理器</span></div><div><span style="font-size: 16pt;">getHandler()会返回目标处理器类的执行链；</span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;">handlerMapping：处理器映射，里面保存了每一个处理器能处理哪些请求的映射信息。</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [10].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [11].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">遍历HandlerMapping：IOC容器一启动创建Controller对象时会自动扫描每个Request Mapping能处理哪些请求，扫描后保存在handlerMapping的HandlerMap属性中。下一次请求过来，就看哪个HandlerMapping中有这个请求映射信息。</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [12].png" type="image/png" data-filename="Image.png"/></span></div><hr/><div><span style="font-size: 16pt;">4、</span><span style="font-size: 16pt;">getHandlerAdapter（）细节：如何找到目标处理类的适配器，因为要拿适配器去执行目标方法</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [13].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">进入getHandlerAdapter()方法：</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [14].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">用到了注解适配器AnnotationMethodHandlerAdapter</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [15].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><hr/><div><span style="font-size: 16pt;">5、DispatcherServlet中的九大组件：</span></div><div><span style="font-size: 16pt;">SpringMVC在工作时，关键位置都是由这些组件完成的。</span></div><div><span style="font-size: 16pt;">共同点：九大组件全是接口，接口就是规范。提供了非常强大的扩展性；</span></div><div><span style="font-size: 16pt;">难点：SpringMVC九大组件工作原理。</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [16].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    </span><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [17].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    <img src="SpringMVC源码_files/Image [18].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    <img src="SpringMVC源码_files/Image [19].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">     <img src="SpringMVC源码_files/Image [20].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">     <img src="SpringMVC源码_files/Image [21].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">     <img src="SpringMVC源码_files/Image [22].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">    <img src="SpringMVC源码_files/Image [23].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">   <img src="SpringMVC源码_files/Image [24].png" type="image/png" data-filename="Image.png"/></span></div><hr/><div><span style="font-size: 16pt;">6.九大组件初始化</span></div><div><span style="font-size: 16pt;">DispatcherServlet中有一个onRefresh()方法，是在Spring源码中预留给子类的方法:</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [25].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 21.3333px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">DispatcherServlet中的方法：</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [26].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">initStrategies()方法有九大组件的初始化:</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [27].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">可以在web.xml中修改DispatcherServlet某些属性的默认值</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [28].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">总结：去容器中找这个组件，如果找不到就用默认的配置；</span></div><div><span style="font-size: 16pt;">有些组件在容器中适用类型找，有些组件使用id找。</span></div><hr/><div><span style="font-size: 16pt;">7.SpringMVC如何通过反射执行控制器中的目标方法？尤其是参数的不确定？</span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [29].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [30].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">进入源码调试后到达：</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [31].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [32].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">           <img src="SpringMVC源码_files/Image [33].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">重点</span><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [34].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"> ||</span></div><div><span style="font-size: 16pt;"> ||</span></div><div><span style="font-size: 16pt;">\ /</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [35].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">执行完findBridgedMethod()方法后返回的执行的方法包含具体的参数：</span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [36].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [37].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [38].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [39].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [40].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><hr/><div><span style="font-size: 16pt;">8.如何确定方法的每一个参数的值，总共有四个参数：</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [41].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">标了注解：</span></div><div><span style="font-size: 16pt;">保存是哪个注解的详细信息，进入</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [42].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [43].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;">没标注解：</span></div><div><span style="font-size: 16pt;">（1）是否普通参数（原生API）再看是否Model或者Map</span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [44].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [45].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">（2）自定义类型的参数没有注解，先看是否原生API，再看是否Model，或者Map，再看是否为其他类型SessionStatus、HttEntity、Errors，再看是否简单类型的属性，比如是否Integer，String等基本类型，如果是paramName=&quot;&quot;;最后是attrName=&quot;&quot;;</span></div><div><span style="font-size: 16pt;">然后确定自定义类型参数的值，还要将请求中的每一个参数赋值给这个对象</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [46].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [47].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">如果attrName是空串，将参数类型的首字母小写作为值，例如Book =》book</span></div><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [48].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><span style="font-size: 16pt; color: rgb(188, 0, 88);">SpringMVC确定POJO值得三步：</span>（1）如果隐含模型中有这个key（标了ModelAttribution注解就是注解指定的value，没有就是参数类型首字母小写），直接赋值给目标对象</span></div><div><span style="font-size: 16pt;">（2）如果是SessionAttributes标注的属性，就从session拿</span></div><div><span style="font-size: 16pt;">（3）如果都没有就利用反射创建对象。</span></div><hr/><div><span style="font-size: 16pt;"><img src="SpringMVC源码_files/Image [49].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;">     <img src="SpringMVC源码_files/Image [50].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><br/></span></div></div><div><br/></div></span>
</div></body></html> 